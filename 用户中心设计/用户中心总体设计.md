# 多租户用户中心总体设计

| 租户类型 | 资源分配 |     |     |     |
| :------: | :------: | :-: | :-: | :-: |
|  集团型  |  多集群  |     |     |     |
|  公司型  |  单集群  |     |     |     |
|  应用型  | 命名空间 |     |     |     |
|          |          |     |     |     |

###  租户创建-云原生方案
``` plantuml
@startuml

actor admin 
admin --> [租户] : 创建
 
      [租户] <... [公司型租户] 
      [租户] <... [集团型租户]
         [租户] <... [应用型租户]
node 服务 as server {
    component po_3 
    component deploy
    component service
    service --> po_3 : 1..n
    deploy --> po_3 : 1..n
}
         
[虚拟集群] ->  [物理节点] : n*..n
[命名空间] -> [虚拟集群] : 1..n
[命名空间]  --> server : 1..n
[命名空间]  --> [job] : 1..n
[命名空间]  --> [pvc] : 1..n


[应用型租户] ---> [命名空间] : 1..n 
[集团型租户] --> [虚拟集群] : 1..n
[公司型租户]  --> [虚拟集群] : 1..1
@enduml
```

## 应用-命名空间设计
```
每个应用对应一个命名空间
平台提供应用商店为每个应用提供开箱即用的服务容器。
应用开发人员可以在应用商店购买相应的服务容器后进行配置。
平台可按应用申请的费用来控制命名空间可使用的资源容量。
```

``` plantuml
@startuml
   title 应用-命名空间设计
   [应用] --> [命名空间] : 1..1
   [命名空间] --> [服务编排] 
   [命名空间] --> [安全公共域]
   [命名空间] --> [数据分析公共域]
   [命名空间] --> [应用基础公共域]
   [命名空间] --> [主数据]
   [安全公共域] --> [认证]
   [安全公共域] --> [授权]
   [应用基础公共域] --> [日志采集]
   [应用基础公共域] --> [应用运行监控]
   [应用基础公共域] --> [应用治理]
   [主数据] --> [用户及组织机构]
   [数据分析公共域] --> [用户画像]
   [数据分析公共域] --> [日志分析]
   [数据分析公共域] --> [统计分析]
   [数据分析公共域] --> [BI分析]
   [数据分析公共域] --> [AI分析]
@enduml
```


### 用户中心—主数据设计

```
用户中心只有“用户API服务”能够对外暴露服务。
不能直接访问用户中心的其它服务。
“用户API服务”职责是对包内的其它服务进行聚合查询，代理、缓存。
“部门接口”和“公司接口”都属于组织机构，可以进行扩展。例如：“科室接口”，“职位接口”，“岗位接口”
所有组织机构都是从“树容器”扩展而来，“树容器”是对数据结构：树的具体实现。

用户服务可选使用OpenLdap来实现。优点：可以多集群、多项目进行用户关联。
```
``` plantuml

@startuml
package "主数据" {
  [+用户API服务] --> [部门接口]
 [+用户API服务] --> [公司接口]
     [+用户API服务] --> [用户接口]
     [部门接口] --> [树容器]
     [公司接口] --> [树容器]
     [用户接口] --> [Ldap]
}



``` 